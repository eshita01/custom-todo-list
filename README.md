# Todo Example Using Supabase

## Version 2.2 - Adding Notifications for Task Assignments

This project extends the basic Todo List application with the following features:
- Shared Todo List functionality.
- Notifications for assigned tasks.

### Frontend:
- [Next.js](https://github.com/vercel/next.js) - A React framework for production.
- [Tailwind](https://tailwindcss.com/) for styling and layout.
- [Supabase.js](https://supabase.com/docs/library/getting-started) for user management and real-time data syncing.

### Backend:
- [supabase.com/dashboard](https://supabase.com/dashboard/): Hosted Postgres database with restful API for usage with Supabase.js.

---

## Deploy with Vercel

The Vercel deployment will guide you through creating a Supabase account and project. After installation of the Supabase integration, all relevant environment variables will be set up so that the project is usable immediately after deployment ðŸš€

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2Fsupabase%2Fsupabase%2Ftree%2Fmaster%2Fexamples%2Ftodo-list%2Fnextjs-todo-list&project-name=supabase-nextjs-todo-list&repository-name=supabase-nextjs-todo-list&integration-ids=oac_VqOgBHqhEoFTPzGkPd7L0iH6&external-id=https%3A%2F%2Fgithub.com%2Fsupabase%2Fsupabase%2Ftree%2Fmaster%2Fexamples%2Ftodo-list%2Fnextjs-todo-list)

---

## Project Setup

### 1. Create a New Project in Supabase

Sign up on [Supabase Dashboard](https://supabase.com/dashboard) and create a new project. Wait for your database to start.

### 2. SQL Setup for Todo List and Notifications

1. Navigate to the `SQL editor` tab in Supabase.
2. Run the following SQL script to set up the database schema, policies, and trigger for task assignment notifications:

```sql
-- Create todos table with row-level security
create table todos (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users not null,
  task text check (char_length(task) > 3),
  is_complete boolean default false,
  inserted_at timestamp with time zone default timezone('utc'::text, now()) not null
);
alter table todos enable row level security;
create policy "Individuals can create todos." on todos for
    insert with check (auth.uid() = user_id);
create policy "Individuals can view their own todos. " on todos for
    select using ((select auth.uid()) = user_id);
create policy "Individuals can update their own todos." on todos for
    update using ((select auth.uid()) = user_id);
create policy "Individuals can delete their own todos." on todos for
    delete using ((select auth.uid()) = user_id);

-- Create notifications table
CREATE TABLE notifications (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  task_id BIGINT REFERENCES todos(id) NOT NULL,
  message TEXT NOT NULL,
  is_read BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Enable row-level security for notifications
ALTER TABLE notifications ENABLE ROW LEVEL SECURITY;

-- Policies for notifications
CREATE POLICY "Users can view their own notifications." ON notifications
FOR SELECT USING ((auth.uid() = user_id));

CREATE POLICY "Users can mark their notifications as read." ON notifications
FOR UPDATE USING ((auth.uid() = user_id));

-- Trigger for notifications on task assignment
CREATE OR REPLACE FUNCTION notify_task_assignment()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO notifications (user_id, task_id, message)
  VALUES (
    NEW.user_id,
    NEW.id,
    CONCAT('You have been assigned a new task: ', NEW.task)
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER task_assignment_notification
AFTER INSERT ON todos
FOR EACH ROW
WHEN (NEW.user_id IS NOT NULL)
EXECUTE FUNCTION notify_task_assignment();
```
# Todo List with Notifications

## Environment Variables Setup

1. Navigate to **Project Settings** (cog icon) in Supabase.
2. Go to the **API** tab and copy the `URL` and `anon` key.
3. Create a `.env.local` file in your project root and populate it with the following:

```env
   NEXT_PUBLIC_SUPABASE_URL=<your-supabase-url>
   NEXT_PUBLIC_SUPABASE_ANON_KEY=<your-anon-key>
```
Replace <your-supabase-url> and <your-anon-key> with your Supabase project details.

## Run the Project Locally
### Install dependencies:
```bash
npm install
```
Start the development server:
```bash
npm run dev
```
## Notifications Feature
Task Assignment Notifications: A notification is automatically created whenever a task is assigned to a user.
User Notifications:
Users can:
View notifications.
Mark notifications as read.
Security: Notifications are managed using row-level security (RLS), ensuring only the intended recipient can access or update their notifications.
## Vercel Preview with Branching
Supabase integrates seamlessly with Vercel to provide preview branches with dedicated Supabase projects. This allows you to safely test database migrations or service configurations.

### Steps:
Ensure the Vercel project is linked to a Git repository.
Configure the Preview Environment Variables in Vercel:
```
NEXT_PUBLIC_SUPABASE_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY
```
Create a new branch, make changes (e.g., update a feature or configuration), and push it to Git.
Open a pull request to trigger Vercel + Supabase integration.
Upon successful deployment, the preview environment reflects the changes for testing.
##Supabase Details and Authorization
Postgres Row-Level Security (RLS): Used for fine-grained control over access to tasks and notifications.
## Authorization:
For unauthenticated access, the anon key is used.
Once logged in, user access is controlled by their JWT.
##Authors
This project is based on the Supabase Todo Example.
Supabase is open-source, and contributions are welcome.
